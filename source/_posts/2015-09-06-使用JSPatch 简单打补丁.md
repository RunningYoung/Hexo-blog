---
layout: post
title: "ä½¿ç”¨JSPatch ç®€å•æ‰“è¡¥ä¸"
description: ""
category: ios
tags: [JSPatch]
author: ciefky
---  



##å…³äº'JSPatch'

###JSPatch çš„åŸç†

JSä¼ é€’å­—ç¬¦ä¸²ç»™OCï¼ŒOCé€šè¿‡ Runtime æ¥å£è°ƒç”¨å’Œæ›¿æ¢OCæ–¹æ³•ã€‚

èƒ½åšåˆ°é€šè¿‡JSè°ƒç”¨å’Œæ”¹å†™OCæ–¹æ³•æœ€æ ¹æœ¬çš„åŸå› æ˜¯ Objective-C æ˜¯åŠ¨æ€è¯­è¨€ï¼ŒOCä¸Šæ‰€æœ‰æ–¹æ³•çš„è°ƒç”¨/ç±»çš„ç”Ÿæˆéƒ½é€šè¿‡ Objective-C Runtime åœ¨è¿è¡Œæ—¶è¿›è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç±»å/æ–¹æ³•ååå°„å¾—åˆ°ç›¸åº”çš„ç±»å’Œæ–¹æ³•ã€‚
å¯¹äº Objective-C å¯¹è±¡æ¨¡å‹å’ŒåŠ¨æ€æ¶ˆæ¯å‘é€çš„åŸç†å·²æœ‰å¾ˆå¤šæ–‡ç« é˜è¿°å¾—å¾ˆè¯¦ç»†ï¼Œä¾‹å¦‚[è¿™ç¯‡](http://blog.csdn.net/kesalin/article/details/6689226)ï¼Œè¿™é‡Œå°±ä¸è¯¦ç»†é˜è¿°äº†ã€‚

ç†è®ºä¸Šä½ å¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡ç±»å/æ–¹æ³•åè°ƒç”¨åˆ°ä»»ä½•OCæ–¹æ³•ï¼Œæ›¿æ¢ä»»ä½•ç±»çš„å®ç°ä»¥åŠæ–°å¢ä»»æ„ç±»ã€‚

[JSPatchå®ç°åŸç†è¯¦è§£](http://blog.cnbang.net/tech/2808/)

[JSPatchå®ç°åŸç†è¯¦è§£<äºŒ>](http://blog.cnbang.net/tech/2855/)

####JSPatch å®‰å…¨
ä½¿ç”¨ JSPatch æœ‰ä¸¤ä¸ªå®‰å…¨é—®é¢˜:

1.  ä¼ è¾“å®‰å…¨ï¼šJS è„šæœ¬å¯ä»¥è°ƒç”¨ä»»æ„ OC æ–¹æ³•ï¼Œæƒé™éå¸¸å¤§ï¼Œè‹¥è¢«ä¸­é—´äººæ”»å‡»æ›¿æ¢ä»£ç ï¼Œä¼šé€ æˆè¾ƒå¤§çš„å±å®³ã€‚

2.  æ‰§è¡Œå®‰å…¨ï¼šä¸‹å‘çš„ JS è„šæœ¬çµæ´»åº¦å¤§ï¼Œç›¸å½“äºä¸€æ¬¡å°å‹æ›´æ–°ï¼Œè‹¥æœªè¿›è¡Œå……åˆ†æµ‹è¯•ï¼Œå¯èƒ½ä¼šå‡ºç° crash ç­‰æƒ…å†µå¯¹ APP ç¨³å®šæ€§é€ æˆå½±å“ã€‚

è§£å†³æ–¹æ¡ˆï¼š[JSPatch éƒ¨ç½²å®‰å…¨ç­–ç•¥](http://blog.cnbang.net/tech/2879/)

###JSPatchçš„ä½¿ç”¨
JSä»£ç æ›¿æ¢è§„åˆ™

![](http://i1.tietuku.com/544f70c5fb2fc438.png)

ğŸŒ°ä¾‹å­ï¼š
å°†  **`ParentViewController ` çš„ `viewDidAppear`æ–¹æ³• è¦†ç›–**ï¼Œé™„ä»£ç :

    defineClass('ParentViewController', {
                        
            viewDidAppear: function(animated) {
            // self.ORIGviewDidAppear(animated); // åŠ å…¥å‰ç¼€ORIG ä¼šå¤ç”¨åŸæ¥çš„æ–¹æ³•ç»§ç»­æ‰§è¡Œåç»­æ“ä½œ,
            console.log("Pathc æˆåŠŸ");
            var label = require('UILabel').alloc().initWithFrame({x:50, y:90, width:135, height:135});
            label.setTag(1001);            label.setBackgroundColor(require('UIColor').colorWithRed_green_blue_alpha(255.0/255.0,126.0/255.0,0.0/255.0,1));
            label.setUserInteractionEnabled(true);
            self.view().addSubview(label);
            
            }
            //
            
            .......   // æ­¤å¤„å¯ç»§ç»­æ·»åŠ éœ€è¦è¦†ç›–çš„æ–¹æ³•
            
            //            
            })
            


å°†æ­¤æ®µä»£ç ç²˜åˆ°ä¸€ä¸ª `XXX.js` æ–‡ä»¶ä¸­*(æˆ‘ä»¬çš„é¡¹ç›®jsä»£ç éƒ½æ”¾åœ¨äº†â€œSAEåœ¨çº¿ç®¡ç†å¹³å°â€ä¸Š,åªè¦æŠŠå†™å¥½çš„ä»£ç æ”¾è¿›`content`ä¸­ï¼Œé…ç½®å¥½ç›¸å…³å‚æ•°å³å¯ï¼Œæ— éœ€æ‰§è¡Œä¸‹æ®µçš„ä»£ç )*ï¼Œç„¶ååœ¨ `AppDelegate.m` çš„`didFinishLaunchingWithOptions`æ–¹æ³•ä¸­æ‰§è¡Œä¸‹é¢ä»£ç å³å¯:


    [JPEngine startEngine];
    NSString *sourcePath = [[NSBundle mainBundle] pathForResource:@"XXX" ofType:@"js"];
    NSString *script = [NSString stringWithContentsOfFile:sourcePath encoding:NSUTF8StringEncoding error:nil];
    [JPEngine evaluateScript:script];
            
  
JSçš„ä½¿ç”¨ä¸Šæ‰‹æ¯”è¾ƒå®¹æ˜“ï¼Œç¼–ç¨‹è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ä¸»è¦åœ¨äºè¯­æ³•è§„åˆ™ä¸Šï¼Œè¿™è¦æ±‚ç¨‹åºå‘˜ç¼–ç æ—¶ä¸€æ˜¯è¦å¯¹jsè¯­æ³•ç†Ÿæ‚‰ï¼ŒäºŒæ˜¯è¦æ±‚ç»†å¿ƒï¼Œç»†å¿ƒï¼Œå†ç»†å¿ƒã€‚

[è¿™é‡Œ](https://github.com/bang590/JSPatch/wiki/JSPatch%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E7%AD%94) æ±‡é›†äº†å¤§éƒ¨åˆ†çš„è¯­æ³•è§„åˆ™å’Œå¸¸è§çš„é—®é¢˜,å¼€å‘æ—¶é‡åˆ°é—®é¢˜åŸºæœ¬éƒ½èƒ½æ‰¾åˆ°è§£å†³åŠæ³•ã€‚


###JSPatch æ±‡æ€»

[JSPatchå­¦ä¹  æ–‡ç« æ±‡æ€»ï¼ˆå¤šç¯‡ï¼‰](https://github.com/bang590/JSPatch/wiki)

[JSPatch å®˜æ–¹demo](https://github.com/bang590/JSPatch)
  
            
